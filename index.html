<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>자재 관리 시스템</title>
  <style>
    .hidden { display: none; }
    .card {
      padding: 20px;
      margin: 10px;
      border: 1px solid #ccc;
      cursor: pointer;
      text-align: center;
    }
    .button { padding: 10px 20px; }
    #material-form, #warehouse-cards, #team-cards, #material-list { display: none; }
  </style>
</head>
<body>

  <h1>자재 관리 시스템</h1>

  <!-- 자재 현황 카드 (맨 처음 보여지는 카드) -->
  <div id="material-status-card" class="card">자재 현황 보기</div>

  <!-- 팀 선택 카드들 -->
  <div id="team-cards" class="hidden">
    <div class="card" id="team-1">팀 1</div>
    <div class="card" id="team-2">팀 2</div>
    <div class="card" id="team-3">팀 3</div>
  </div>

  <!-- 창고 선택 카드들 -->
  <div id="warehouse-cards" class="hidden">
    <div class="card" id="warehouse-1">창고 1</div>
    <div class="card" id="warehouse-2">창고 2</div>
    <div class="card" id="warehouse-3">창고 3</div>
    <div class="card" id="warehouse-4">창고 4</div>
  </div>

  <!-- 자재 목록 (자재 목록을 나열할 부분) -->
  <div id="material-list" class="hidden">
    <h3>자재 목록</h3>
    <div id="material-list-container"></div> <!-- 자재 항목들이 여기에 표시됨 -->
    <!-- 설정 버튼을 클릭하면 자재 수정/삭제 버튼이 보이도록 설정 -->
    <button id="settings-button" class="button">설정</button>
    <button id="add-material-btn" class="button hidden">자재 추가</button>
  </div>

  <!-- 자재 수정/추가 폼 -->
  <div id="material-form" class="hidden">
    <h3>자재 수정/추가</h3>
    <label for="material-name">자재 이름:</label>
    <input type="text" id="material-name" />
    <label for="material-quantity">수량:</label>
    <input type="number" id="material-quantity" />
    <button id="save-material" class="button">저장</button> <!-- 자재 추가 또는 수정 버튼 -->
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // Firebase 설정
    const firebaseConfig = {
      apiKey: "AIzaSyBFnvY4Adn35uSb0RztjBKkPkRnhuOCYn4",
      authDomain: "korail-dac64.firebaseapp.com",
      databaseURL: "https://korail-dac64-default-rtdb.firebaseio.com",
      projectId: "korail-dac64",
      storageBucket: "korail-dac64.firebasestorage.app",
      messagingSenderId: "366259094919",
      appId: "1:366259094919:web:ab1c74c4f38a799113bf22",
    };

    // Firebase 초기화
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let selectedTeam = null;
    let selectedWarehouse = null;
    let selectedMaterialKey = null;
    let settingsVisible = false; // 설정 메뉴가 보이는지 여부를 추적

    // 자재 현황 카드 클릭 시 팀 선택 카드 보이기
    document.getElementById('material-status-card').onclick = function() {
      document.getElementById('material-status-card').style.display = 'none'; // 자재 현황 카드는 숨김
      document.getElementById('team-cards').style.display = 'block'; // 팀 선택 카드 보이기
    };

    // 팀 선택 시 창고 카드 보이기
    document.getElementById('team-1').onclick = function() { selectTeam(1); };
    document.getElementById('team-2').onclick = function() { selectTeam(2); };
    document.getElementById('team-3').onclick = function() { selectTeam(3); };

    function selectTeam(teamId) {
      selectedTeam = teamId;
      document.getElementById('team-cards').style.display = 'none'; // 팀 카드 숨김
      document.getElementById('warehouse-cards').style.display = 'block'; // 창고 카드 보이기
    }

    // 창고 선택 시 자재 목록 보이기
    document.getElementById('warehouse-1').onclick = function() { selectWarehouse(1); };
    document.getElementById('warehouse-2').onclick = function() { selectWarehouse(2); };
    document.getElementById('warehouse-3').onclick = function() { selectWarehouse(3); };
    document.getElementById('warehouse-4').onclick = function() { selectWarehouse(4); };

    function selectWarehouse(warehouseId) {
      selectedWarehouse = warehouseId;
      document.getElementById('warehouse-cards').style.display = 'none'; // 창고 카드 숨김
      document.getElementById('material-list').style.display = 'block'; // 자재 목록 보이기
      loadMaterialData();
    }

    // 선택된 창고에 해당하는 자재 데이터를 로드하는 함수 (Firebase에서 데이터 가져오기)
    function loadMaterialData() {
      const materialRef = db.ref(`teams/team${selectedTeam}/warehouses/warehouse${selectedWarehouse}/materials`);
      materialRef.once('value', function(snapshot) {
        const materials = snapshot.val();
        renderMaterialList(materials);
      });
    }

    // 자재 목록 렌더링
    function renderMaterialList(materials) {
      const container = document.getElementById('material-list-container');
      container.innerHTML = ''; // 자재 목록 초기화

      if (materials) {
        for (const key in materials) {
          const material = materials[key];
          const div = document.createElement('div');
          div.className = 'card';
          div.textContent = `${material.name}: ${material.quantity}`;

          // 수정 버튼 (기본적으로 숨기기)
          const editButton = document.createElement('button');
          editButton.textContent = '수정';
          editButton.classList.add('hidden');
          editButton.onclick = () => {
            loadMaterialForEdit(key, material);
          };

          // 삭제 버튼 (기본적으로 숨기기)
          const deleteButton = document.createElement('button');
          deleteButton.textContent = '삭제';
          deleteButton.classList.add('hidden');
          deleteButton.onclick = () => {
            if (window.confirm("삭제하시겠습니까?")) {
              deleteMaterial(key);
            }
          };

          div.appendChild(editButton);
          div.appendChild(deleteButton);
          container.appendChild(div);
        }
      }
    }

    // 자재 수정 폼에 데이터 로드
    function loadMaterialForEdit(key, material) {
      selectedMaterialKey = key; // 수정할 자재의 키 저장
      document.getElementById('material-name').value = material.name;
      document.getElementById('material-quantity').value = material.quantity;

      document.getElementById('material-form').style.display = 'block'; // 자재 수정 폼 보이기
    }

    // 자재 수정/저장
    document.getElementById('save-material').onclick = function() {
      const name = document.getElementById('material-name').value;
      const quantity = document.getElementById('material-quantity').value;

      const materialToSave = {
        name: name,
        quantity: quantity
      };

      const materialRef = db.ref(`teams/team${selectedTeam}/warehouses/warehouse${selectedWarehouse}/materials/${selectedMaterialKey}`);
      materialRef.set(materialToSave); // 자재 수정 저장
      loadMaterialData(); // 자재 목록 다시 로드
      document.getElementById('material-form').style.display = 'none'; // 수정 폼 숨기기
    };

    // 자재 삭제
    function deleteMaterial(key) {
      const materialRef = db.ref(`teams/team${selectedTeam}/warehouses/warehouse${selectedWarehouse}/materials/${key}`);
      materialRef.remove(); // 자재 삭제
      loadMaterialData(); // 자재 목록 다시 로드
    }

    // 자재 추가
    document.getElementById('add-material-btn').onclick = function() {
      document.getElementById('material-name').value = '';
      document.getElementById('material-quantity').value = '';
      document.getElementById('material-form').style.display = 'block'; // 자재 추가 폼 보이기
      selectedMaterialKey = null; // 자재 추가 모드
      document.getElementById('save-material').textContent = '저장'; // 자재 추가 버튼으로 이름 변경
    };

    // 자재 추가/저장 버튼
    document.getElementById('save-material').onclick = function() {
      const name = document.getElementById('material-name').value;
      const quantity = document.getElementById('material-quantity').value;

      if (!name || !quantity) {
        alert('자재 이름과 수량을 모두 입력하세요!');
        return;
      }

      const materialToSave = {
        name: name,
        quantity: quantity
      };

      // 자재 추가
      if (!selectedMaterialKey) {
        const materialRef = db.ref(`teams/team${selectedTeam}/warehouses/warehouse${selectedWarehouse}/materials`);
        materialRef.push(materialToSave); // 자재 추가
      } else {
        // 자재 수정
        const materialRef = db.ref(`teams/team${selectedTeam}/warehouses/warehouse${selectedWarehouse}/materials/${selectedMaterialKey}`);
        materialRef.set(materialToSave); // 자재 수정
      }

      loadMaterialData(); // 자재 목록 다시 로드
    };

    // 설정 버튼 클릭 시 자재 목록 옆의 수정/삭제 버튼 보이기/숨기기
    document.getElementById('settings-button').onclick = function() {
      const editButtons = document.querySelectorAll('#material-list-container .card button:nth-child(1)');
      const deleteButtons = document.querySelectorAll('#material-list-container .card button:nth-child(2)');
      
      // 수정 및 삭제 버튼 보이기/숨기기
      editButtons.forEach(button => button.classList.toggle('hidden'));
      deleteButtons.forEach(button => button.classList.toggle('hidden'));

      // 자재 추가 버튼 보이기/숨기기
      const addMaterialButton = document.getElementById('add-material-btn');
      addMaterialButton.classList.toggle('hidden');
    };
  </script>

</body>
</html>
